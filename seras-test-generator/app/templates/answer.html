<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>確認テスト【解答・解説】</title>
</head>
<body>
  <header>
    <h1>確認テスト【解答・解説】</h1>
    <div class="meta">
      <span class="range">範囲: {{ data.sections_label }}</span>
    </div>
  </header>

  {% if data.warmup_questions %}
  <section class="warmup-section">
    <h2>ウォームアップ 解答</h2>
    {% for q in data.warmup_questions %}
    <div class="answer-item">
      <p class="q-number">({{ q.number }})</p>
      <p class="answer-text">{{ q.answer }}</p>
      <p class="source">[{{ q.node_id }}: {{ q.node_name }}]</p>
      <p class="reference">→ はじめの英文読解ドリル {{ q.reference_pages }}</p>
      <p class="warmup-note">※ {{ q.note }}</p>
    </div>
    {% endfor %}
  </section>
  {% endif %}

  {% for ns in data.node_sections %}
  <section class="node-section">
    <div class="node-section-header">
      <h2>セクション {{ ns.section_number }}: {{ ns.node_name }} [{{ ns.node_id }}]</h2>
    </div>

    {% if ns.knowledge_questions %}
    <p class="sub-heading">知識確認 解答:</p>
    {% for q in ns.knowledge_questions %}
    <div class="answer-item">
      <p class="q-number">({{ q.number }})</p>
      <p class="answer-text">{{ q.answer }}</p>
      <p class="source">[{{ q.node_id }}: {{ q.node_name }}]</p>
      <p class="reference">→ はじめの英文読解ドリル {{ q.reference_pages }}</p>
    </div>
    {% endfor %}
    {% endif %}

    {% if ns.sentence_questions %}
    <p class="sub-heading">英文 解答:</p>
    {% for q in ns.sentence_questions %}
    <div class="answer-item">
      <p class="q-number">({{ q.number }})</p>
      <p class="q-english">{{ q.english }}</p>
      <p>構造: {{ q.structure }}</p>
      <p>和訳: {{ q.japanese }}</p>
      {% if q.notes %}
      <p class="notes">{{ q.notes }}</p>
      {% endif %}
      <p class="source">[{{ q.knowledge_tags | join(', ') }}]</p>
      <p class="reference">→ はじめの英文読解ドリル {{ q.source_pages }}</p>
    </div>
    {% endfor %}
    {% endif %}

    {% if ns.review_guide %}
    <div class="review-guide">
      <p class="review-guide-title">この問題が解けなかった場合:</p>
      {% for rg in ns.review_guide %}
      <p class="review-guide-item">→ {{ rg.node_id }}: {{ rg.node_name }}（{{ rg.reference_pages }}）を復習{% if rg.reason %}（{{ rg.reason }}）{% endif %}</p>
      {% endfor %}
    </div>
    {% endif %}
  </section>
  {% endfor %}
</body>
</html>
