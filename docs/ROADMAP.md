# ロードマップ

> 最終更新: 2026-02-13（Phase F-1 肘井構造化完了）

## フェーズ一覧

| Phase | 内容 | 状態 | 備考 |
|-------|------|------|------|
| **A** | はじめの英文読解ドリル構造化（Ch01-06） | **完了** | 84ノード・498英文（粒度調整後） |
| **B** | 知識ノード品質改善（AI主導の粒度・難易度修正） | **完了** | 粒度調整71→84ノード、check_points構造化完了 |
| **B'** | 知識ノード品質改善（人間主導の内容修正） | 未着手 | C完了後に開始。講師目線でAIと相談しながら継続的に改善 |
| **C** | 確認テスト生成API | **完了** | Cloud Run デプロイ済み、GAS統合完了、複数参考書対応済み |
| **D** | Exam_01, Exam_02 構造化 | **完了** | 26英文追加（7+19）、既存84ノードへのタグ付けのみ |
| **E** | Webアプリ（閲覧）+ DB移行 | **完了** | Supabase移行、Cloud Runデプロイ、Next.js閲覧アプリ |
| **F** | 他参考書の独立構造化＋参考書間リンク | **進行中** | F-1: 肘井の読解のための英文法 構造化完了（39ノード・405英文） |
| **G** | 生徒習熟度管理・SM-2 | 未着手 | |

## タイムライン

```
完了 ──── Phase A〜E ──── 実運用開始（2026-02-13）──→
                              │
                              ├── Phase D 完了（2026-02-13）
                              │    Exam_01/02 構造化、全41セクション完了
                              ├── Phase E 完了（2026-02-13）
                              │    DB移行完了、YAML削除済み
                              ├── Phase F-1 完了（2026-02-13）
                              │    肘井の読解のための英文法 構造化（39ノード・405英文）
                              ├── B'開始 ──── B'継続（長期）──→
                              └── F-2〜 残り参考書 ──→
```

## 実運用開始の条件（すべて達成済み）

- ~~Phase C（確認テスト生成API）が完了し、GASから呼び出せる状態~~ → 完了
- ~~GAS統合（呼び出し側スクリプト）の実装~~ → 完了（スプレッドシートUIから生成可能）
- ~~Phase B の粒度修正が一段落している~~ → 完了

## 各フェーズの詳細

### Phase A: 構造化（完了）
- 「はじめの英文読解ドリル」Ch01〜Ch06の全39セクション
- 知識ノード84件（粒度調整後）、英文498件、5カテゴリ
- 設計: [構造化設計案](design/構造化設計案_はじめの英文読解ドリル.md)
- ワークフロー: [作業ワークフロー](design/作業ワークフロー.md)
- ログ: [作業ログ](log/作業ログ.md)

### Phase B: 知識ノード品質改善（AI主導）（完了）
- 粒度調整: 71→84ノード。全Chapter 2.0ノード/セクション以上に統一
- check_points構造化: 文字列形式 → question/answer dict形式に全84ノード変換
- 難易度（priority）の見直し

### Phase B': 知識ノード品質改善（人間主導）
- 講師目線での内容修正
- 知識の必要性判断、表現の調整
- AIと相談しながら継続的に改善
- 終わりが明確でなく、運用しながら磨き続ける

### Phase C: 確認テスト生成API（完了）
- 設計: [確認テスト生成API設計書](design/確認テスト生成API_設計書.md)
- 改善指示: [確認テスト改善指示書](design/確認テスト改善_指示書.md)
- 実装完了（FastAPI + Jinja2 + WeasyPrint + GCS）、68テスト全GREEN
- 4つの改善を適用済み:
  1. ウォームアップ問題（前提知識の復習）
  2. 英文問題に着眼点（どの知識を使うか表示）
  3. ノード単位のセット出題（知識確認→英文を紐付け）
  4. 解答の逆引きガイド（間違えた時の復習先）
- 出題アルゴリズム改善（2026-02-12）:
  - ランダム化: ウォームアップ/知識確認/英文の選出を毎回シャッフル
  - 英文問題の全体上限(target_max=6)を撤廃、ノードあたり最大1文のみに変更
- PDF統合: 問題+解答を1つのPDFに統合（改ページで区切り）
- **デプロイ済み（2026-02-12）**:
  - GCP Cloud Run（asia-northeast1）
  - API: `https://seras-test-generator-hif2eccama-an.a.run.app`
  - PDF保存: GCS（`gs://seras-test-pdfs`、公開URL）
  - GCPプロジェクト: `seras-test-generator`
  - CI/CD: GitHub Actions（main push → 自動デプロイ）
- **GAS統合完了（2026-02-13）**: スプレッドシートからセクション範囲を指定してPDF生成可能
- **複数参考書対応（2026-02-13）**: `book` パラメータ追加（hajime/hijii）、肘井もテスト生成可能に
  - 96テスト全GREEN（既存68→96テスト、新規28テスト追加）
  - reference_pages のYAML/Supabase両形式対応（既存バグ修正）
  - テンプレートのbook名を動的化
- **実運用開始（2026-02-13）**

### Phase D: Exam構造化（完了）
- Exam_01（入試実戦演習①、p.150-154）: 4大学の入試問題、7英文
- Exam_02（入試実戦演習②、p.155-160）: 共通テスト、19英文
- 新規知識ノードは作成せず、既存84ノードへの knowledge_tags 付与のみ
- `scripts/supabase/import_exam.py` で Supabase に直接投入
- 検証: `verify_supabase.py` 全チェック通過（sentences 524, sections 41）

### Phase E: Webアプリ（閲覧）+ DB移行（完了）
- **E-1: Supabase セットアップ + データ移行（完了）**
  - Supabase (PostgreSQL, Tokyo) に 11テーブル作成
  - YAML → DB インポート完了（84ノード、498英文、39セクション）
  - データ整合性検証スクリプトで全チェック通過
- **E-2: FastAPI テスト生成API の DB 移行（完了）**
  - SupabaseDataStore 実装（postgrest-py）、85テスト全GREEN
  - Cloud Run デプロイ成功、本番API動作確認済み
- **E-3: Next.js 閲覧アプリ構築（完了）**
  - seras-knowledge-viewer（新規リポジトリ）
  - Next.js + CSS Modules + Supabase JS Client
  - 6ページ: ダッシュボード、ノード一覧/詳細、セクション一覧/詳細、英文検索
- **E-4: クリーンアップ（完了）**
  - YAML (knowledge/, sentences/, mappings/) 削除、validate.py 削除
  - CI/CD パストリガー更新、hooks 更新
- 設計: [Phase E 設計案](design/Phase_E_設計案.md)

### Phase F: 他参考書の独立構造化＋参考書間リンク（進行中）

**大方針: 独立ネットワーク＋参考書間リンク（マージしない）**

各参考書は独立した知識ネットワークとして構造化し、参考書間はノード同士のリンクで接続する。
「はじめの英文読解ドリル」のノード体系にマージするのではなく、各参考書の著者の視点・体系をそのまま保存する。

この方針の理由:
- マージすると最初の参考書（はじめの英文読解ドリル）がバイアスとして基準になってしまう
- 各参考書は対等な存在であり、それぞれの切り口に価値がある
- リンクにより「重なり」と「補完」の関係が自然に表現できる
- 新しい参考書を追加しても既存のネットワークに影響しない

参考書間リンクの種類:
- **same_concept** — ほぼ同じ知識を扱っている
- **extends** — 一方がもう一方を詳しく補足している
- **prerequisite** — 一方がもう一方の前提になっている

DBテーブル: `cross_book_links`（DDL: `scripts/supabase/002_cross_book_links.sql`）

対象参考書: 核心、成川、スクランブル、肘井、入門精講

#### F-1: 肘井の読解のための英文法（完了・DB投入済み）
- **39ノード**、**405英文**、**39セクション**、5カテゴリ
  - 序章 SVの発見: 5ノード（hsv-000〜hsv-004）
  - 第1章 意味のカタマリ: 7ノード（hch-001〜hch-007）
  - 第2章 識別: 6ノード（hid-001〜hid-006）
  - 第3章 構文: 10ノード（hco-001〜hco-010）
  - 第4章 動詞の型: 11ノード（hvp-001〜hvp-011）
- 参考書間リンク: 17件（same_concept / extends）
- データ: `scripts/supabase/hijii_data/`（10モジュール）
- インポート: `scripts/supabase/import_hijii.py`
- DDL: `002_cross_book_links.sql` → Supabase CLIマイグレーションで実行済み
- セクションID: `Hij_XX` / 英文ID: `hij-XX-{e,c,a}1-NN`
- DB検証: `verify_supabase.py` 全チェック通過（123ノード・929英文・80セクション）

#### F-2〜: 残り参考書（未着手）
ステップ:
1. 参考書を1冊選び、独立に構造化（その参考書独自のノード体系・ID）
2. 構造化完了後、既存の参考書ネットワークとのリンクを設定
3. 繰り返し

### Phase G: 生徒習熟度管理
- SM-2アルゴリズムによる間隔反復
- 生徒×知識ノードの習熟度DB
